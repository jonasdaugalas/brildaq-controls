<div class="row form-inline">
    <select class="form-control"
            ng-options="own for own in ctrl.owners"
            ng-model="ctrl.owner"></select>

    <button class="btn btn-default"
            ng-click="ctrl.refreshConfigurations()">
        <span class="fa fa-refresh"></span>Refresh
    </button>
</div>

<div class="row">
    <div class="wc-tree-view col-lg-2 col-md-3">
        <h2>Configuration tree</h2>
        <script type="text/ng-template" id="tree-item.html">
            <div style="white-space: nowrap">
                <div ng-if="node._isLeaf">
                    <span ng-show="ctrl.getRunningSuccess"
                          ng-class="node._running ?
                                    'fa fa-heartbeat text-success' :
                                    'fa fa-stop text-muted'">
                    </span>

                    <a ui-sref="editor({path: node._path})">{{name}}</a>
                </div>

                <div ng-if="!node._isLeaf" ng-init="isExpanded = true">
                    <span ng-class="isExpanded ?
                                    'glyphicon glyphicon-folder-open' :
                                    'glyphicon glyphicon-folder-close'">
                    </span>

                    <a href="" ng-click="isExpanded = !isExpanded">
                        {{name}}
                    </a>
                    <div ng-show="isExpanded"
                         class="wc-tree-expanded"
                         ng-repeat="(name,node) in node"
                         ng-include="'tree-item.html'"></div>
                </div>
            </div>
        </script>

        <table>
            <!-- simple workaround to have 'central' on top
                 (cannot easily set order for object keys) -->
            <tr ng-repeat="(name,node) in ctrl.configTree[ctrl.owner]"
                ng-if="name==='central'">
                <td ng-include="'tree-item.html'"></td>
            </tr>

            <tr ng-repeat="(name,node) in ctrl.configTree[ctrl.owner]"
                ng-if="name!=='central'">
                <td ng-include="'tree-item.html'"></td>
            </tr>
        </table>
    </div>

    <div class="col-lg-10 col-md-9" ng-init="dirfilter = 'global'">
        <div class="row form-inline">
            <h2>Running configurations</h2>
            <label for="dirfilter">Filter:</label>
            <select class="form-control"
                    id="dirfilter"
                    ng-options="v as k for (k, v) in
                                {global: 'global',
                                local:'local',
                                'no filter': ''}"
                    ng-model="dirfilter"
                    style="margin: auto;"></select>
        </div>

        <script type="text/ng-template" id="config-block-container.html">
            <h3>{{dirkey}}</h3>
            <div ng-repeat="path in ctrl.running
                            | filter: (ctrl.owner+'/'+dirkey+'/'+dirfilter)"
                 class="panel panel-success">
                <div class="panel-heading">
                    {{path}}
                </div>
                <div class="panel-body">
                    here should be some interesting info about this configuration
                </div>
            </div>
        </script>

        <!-- hack again to keep 'central' first -->
        <div class="col-lg-3 wc-config-panel-group panel-group"
             ng-repeat="(dirkey,dir) in ctrl.configTree[ctrl.owner]"
             ng-if="dirkey==='central'"
             ng-include="'config-block-container.html'">
        </div>

        <div class="col-lg-3 wc-config-panel-group panel-group"
             ng-repeat="(dirkey,dir) in ctrl.configTree[ctrl.owner]"
             ng-if="dirkey!=='central'"
             ng-include="'config-block-container.html'">
        </div>

    </div>
</div>
